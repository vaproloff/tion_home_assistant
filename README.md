# Tion Home Assistant

Компонент для интеграции оборудования Tion в Home Assistant.

Интеграция - облачная, работает через API Tion'а, соответственно, **для работы компонента требуется станция MagicAir**.

![screenshot.png](docs%2Fscreenshot.png)

#### Поддерживаемые устройства:
* Бризер Tion Breezer 3S
* Бризер Tion Breezer 4S
* Станция/шлюз Tion MagicAir
* Модуль CO2+

## Установка

### HACS _(рекомендуется)_:
> Рекомендуется использовать данный способ, что позволит легко следить за обновлениями компонента и легко их устанавливать.
1. `HACS` -> `...` (настройки) -> `Пользовательские репозитории` 
2. Добавьте `vaproloff/tion_home_assistant` в поле `Репозиторий` и выберите тип `Интеграция`. Щелкните кнопку `Добавить`.
3. Перезагрузите Home Assistant

### Вручную:
1. Скачайте zip файл с компонентом
2. Поместите содержимое в `config/custom_components/tion` папку системы Home Assistant
3. Перезагрузите Home Assistant

## Настройка
> `Настройки` -> `Устройства и службы` > `Добавить интеграцию` > `Tion`

Если интеграции нет в списке - очистите кэш браузера.

---
## Использование:
### Устройства Home Assistant, предоставляемые интеграцией:
#### Бризеры Tion:
- термостат `climate`
  - выбор режима `hvac_mode`
  - установка температуры воздуха для подогрева
  - выбор режима качания `swing_mode` _(источник входящего потока воздуха)_
  - выбор скорости `fan_speed`
- датчик температуры входящего потока воздуха `sensor` _(до нагревателя)_
- датчик температуры выходящего потока воздуха `sensor` _(после нагревателя)_
- выключатель подогрева воздуха `switch`
- выключатель подсветки кнопки `switch`
- выключатель звуковых сигналов `switch`
- минимальная скорость для Авто режима `number` _(атрибут speed_min_set объекта climate бризера будет удалён, поддержка - до конца 2024 г.)_
- максимальная скорость для Авто режима `number` _(атрибут speed_max_set объекта climate бризера будет удалён, поддержка - до конца 2024 г.)_
- сенсор даты-времени следующей замены фильтров `sensor` _(атрибут filter_days_left объекта climate бризера будет удалён, поддержка - до конца 2024 г.)_
- бинарный сенсор необходимости замены фильтров `binary_sensor` _(атрибут filter_need_replace объекта climate бризера будет удалён, поддержка - до конца 2024 г.)_

#### Станция MagicAir и Модуль CO2:
- датчик температуры `sensor`
- датчик влажности `sensor`
- датчик уровня CO2 `sensor`
- датчик качества воздуха (содержание частиц PM25) `sensor` _(при наличии)_
- целевой уровень CO2 для Авто режима `number` _(атрибут target_co2 объекта climate бризера будет удалён, поддержка - до конца 2024 г.)_
- выключатель подсветки `switch`

### Службы Home Assistant для управления вашими устройствами:
#### Стандартные сервисы Home Assistant:
* `climate.turn_on` - включение бризера
* `climate.turn_off` - выключение бризера
* `climate.set_temperature` - регулирование уставки температуры бризера
* `climate.set_fan_mode` - установка скорости вентилятора `fan_mode` бризера:
  - `1`-`6` - заданная скорость в ручном режиме
  - `auto` - автоматическое управление скоростью в зависимости от уровня CO2
* `climate.set_hvac_mode` - установка режима работы `hvac_mode` бризера:
  - `heat` - бризер включен, нагреватель включен
  - `fan_only` - бризер включен, нагреватель выключен
  - `off` - бризер выключен
* `climate.set_swing_mode` - выбор входящего потока воздуха бризера в качестве режима качания `swing_mode` термостата:
  - `outside` - с улицы
  - `inside` - из комнаты (доступно только при ручном режиме выбора скорости)
  - `mixed` - смешанный (только для Tion Breezer 3S, доступно только при ручном режиме выбора скорости)
* `number.set_value` - установка целевого значения уровня CO2, минимальной и максимальной скоростей вентилятора для Авто режима
* `switch.turn_on` - включение подогрева, подсветки и звуковых сигналов бризера, модуля CO2, станции MagicAir
* `switch.turn_off` - выключение подогрева, подсветки и звуковых сигналов бризера, модуля CO2, станции MagicAir
* `switch.toggle` - переключение подогрева, подсветки и звуковых сигналов бризера, модуля CO2, станции MagicAir

#### Специальные сервисы компонента Tion:
> данные службы устарели, на замену пришли соответствующие устройства в домене `number`,
> поддержка данных служб - до конца 2024 г.
* `tion.set_zone_target_co2` - регулирование целевого уровня CO2 в Авто режиме бризера
* `tion.set_breezer_min_speed` - установка минимальной скорости в Авто режиме бризера
* `tion.set_breezer_max_speed` - установка максимальной скорости в Авто режиме бризера

---
### Если что-то не работает
1. Создайте топик по [ссылке](https://github.com/vaproloff/tion_home_assistant/issues/new).
2. Опишите проблему, прикрепите логи.
3. Для расширенного логирования необходимо в файл конфигурации `configuration.yaml` добавить:
    ```yaml
    logger:
      default: info
      logs:
        custom_components.tion: debug
    ```
